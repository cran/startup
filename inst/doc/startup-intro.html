<!DOCTYPE html>
<html lang="en">
<head>
<title>startup: Friendly R Startup Configuration</title>
<style>
body {
  font-family: sans-serif;
  line-height: 1.6;
  padding-left: 3ex;
  padding-right: 3ex;
  background-color: white;
  color: black;
}

a {
  color: #4183C4;
  text-decoration: none;
}

h1, h2, h3 {
  margin: 2ex 0 1ex;
  padding: 0;
  font-weight: bold;
  -webkit-font-smoothing: antialiased;
  cursor: text;
  position: relative;
}

h2 {
  border-bottom: 1px solid #cccccc;
}

code {
  margin: 0 2px;
  padding: 0 5px;
  white-space: nowrap;
  border: 1px solid #eaeaea;
  background-color: #f8f8f8;
  border-radius: 3px;
}

pre code {
  margin: 0;
  padding: 0;
  white-space: pre;
  border: none;
  background: transparent;
}

pre {
  background-color: #f8f8f8;
  border: 1px solid #cccccc;
  line-height: 2.5x;
  overflow: auto;
  padding: 0.6ex 1ex;
  border-radius: 3px;
}

pre code {
  background-color: transparent;
  border: none;
}
</style>
</head>
<body>
<h1>startup: Friendly R Startup Configuration</h1>
<!--
%\VignetteIndexEntry{startup: Friendly R Startup Configuration}
%\VignetteAuthor{Henrik Bengtsson}
%\VignetteKeyword{R}
%\VignetteKeyword{package}
%\VignetteKeyword{vignette}
%\VignetteKeyword{Rprofile}
%\VignetteKeyword{Renviron}
%\VignetteEngine{startup::selfonly}
-->
<!-- DO NOT EDIT THIS FILE! Edit 'OVERVIEW.md' instead and then rebuild this file with 'make vigs' -->
<h2>Introduction</h2>
<p>When you start R, it will by default source a <code>.Rprofile</code> file if it exists.  This allows you to automatically tweak your R settings to meet your everyday needs.  For instance, you may want to set the default CRAN repository (<code>options(&quot;repos&quot;)</code>) so you don't have to choose one every time you install a package.</p>
<p>The <strong><a href="https://cran.r-project.org/package=startup">startup</a></strong> package extends the default R startup process by allowing you to put multiple startup scripts in a common '.Rprofile.d' directory and have them all be sourced during the R startup process.  This way you can have one file to configure the default CRAN repository and another one to configure your personal devtools settings.
Similarly, you can use a 'Renviron.d' directory with multiple files defining different environment variables.  For instance, one file may define environment variable <code>LANGUAGE</code>, whereas another file may contain your private <code>GITHUB_PAT</code> key.
The advantages of this approach are that it gives a better overview when you list the files, makes it easier to share certain settings (= certain files) with other users, and enable you to keep specific files completely private (by setting the file privileges so only you can access those settings).</p>
<h2>How the R startup process works</h2>
<p>When R starts, the following <em>user-specific</em> setup takes place:</p>
<ol>
<li>
<p>The <em>first</em> <code>.Renviron</code> file found on the R startup search path is processed.  The search path is (in order): (i) <code>Sys.getenv(&quot;R_ENVIRON_USER&quot;)</code>, (ii) <code>./.Renviron</code>, and (iii) <code>~/.Renviron</code>.  The format of this file is one <code>ENV_VAR=VALUE</code> statement per line, cf. <code>?.Renviron</code>.  <em>NOTE:</em> Some environment variables must be set already in this step in order to be acknowledged by R, i.e. it is <em>too late</em> to set some of them in Step 2 and Step 3 below.</p>
</li>
<li>
<p>The <em>first</em> <code>.Rprofile</code> file found on the R startup search path is processed.  The search path is (in order): (i) <code>Sys.getenv(&quot;R_PROFILE_USER&quot;)</code>, (ii) <code>./.Rprofile</code>, and (iii) <code>~/.Rprofile</code>.  The format of this file must be a valid R script (with a trailing newline), cf. <code>?.Rprofile</code>.</p>
</li>
<li>
<p>If the <code>.Rprofile</code> file (in Step 2) calls <code>startup::startup()</code> then the following will also take place:</p>
<p>a. The <em>first</em> 'Renviron.d' directory on the R startup search path is processed.  The search path is (in order): (i) <code>paste0(Sys.getenv(&quot;R_ENVIRON_USER&quot;), &quot;.d&quot;)</code>, (ii) <code>./.Renviron.d</code>, (iii) <code>~/.Renviron.d</code>, and (iv) <code>{user-cache-dir}/Renviron.d</code>, where <code>{user-cache-dir}</code> corresponds to <code>tools::R_user_dir(&quot;startup&quot;, which = &quot;config&quot;)</code>, e.g. <code>${XDG_CONFIG_HOME}/R/startup</code>.  The format of these files should be the same as for <code>.Renviron</code>.  <em>NOTE:</em> Some environment variables must be set already in Step 1 above in order to be acknowledged by R.</p>
<p>b. A set of handy R options that can be use in Step 3c are set.  Their names are prefixed <code>startup.session.</code> - see <code>?startup::startup_session_options</code> for details.</p>
<p>c. The <em>first</em> 'Rprofile.d' directory found on the R startup search path is processed.  The search path is (in order): (i) <code>paste0(Sys.getenv(&quot;R_PROFILE_USER&quot;), &quot;.d&quot;)</code>, (ii) <code>./.Rprofile.d</code>, (iii) <code>~/.Rprofile.d</code>, and (iv) <code>{user-cache-dir}/Rprofile.d</code>.  The format of these files should be the same as for <code>.Rprofile</code>, that is, they must be valid R scripts.</p>
<p>d. If no errors occur above, the <strong><a href="https://cran.r-project.org/package=startup">startup</a></strong> package will be unloaded, leaving no trace of itself behind, except for R options <code>startup.session.*</code> set in Step 3b - these will be erased if <code>startup::startup()</code> is called with <code>keep = NULL</code>.</p>
</li>
</ol>
<p>All relevant files in 'Renviron.d' and 'Rprofile.d'  directories, including those found recursively in subdirectories thereof, will be processed (in lexicographic order sorted under the <code>C</code> locale).
There are no restrictions on what the file names should be (except for the ones ignored as explained below).  However, for 'Rprofile.d' files we recommend to use filename extension <code>*.R</code> to indicate that the files are regular R scripts.  For 'Renviron.d' files we recommend to use files without extensions (or <code>*.Renviron</code> for clarification).  To avoid confusions, do <em>not</em> use an <code>*.R</code> extension for 'Renviron.d' files because they are not R script per se (as some editors may warn you about).</p>
<p>Files with file extensions <code>*.txt</code>, <code>*.md</code> and <code>*~</code> are ignored as well as any files named <code>.Rhistory</code>, <code>.RData</code> and <code>.DS_Store</code>.  Directories named <code>__MACOSX</code> and their content are ignored.  Files and directories with names starting with two periods (<code>..</code>) are ignored, e.g. <code>~/.Rprofile.d/..my-tests/</code>.</p>
<h2>Installation</h2>
<p>After installing the startup packages (see instructions at the end), call</p>
<pre><code class="language-r">startup::install()
</code></pre>
<p>once.  This will append</p>
<pre><code class="language-r">tryCatch(startup::startup(), error=function(ex) message(&quot;.Rprofile error: &quot;, conditionMessage(ex)))
</code></pre>
<p>to your <code>~/.Rprofile</code>.  The file will be created if missing.  This will also create directories <code>~/.Renviron.d/</code> and <code>~/.Rprofile.d/</code> if missing.  To find the location of these folder on Windows, use <code>normalizePath(&quot;~&quot;)</code> - it's often located under <code>C:\Users\Alice\Documents\</code>.</p>
<p>Alternatively to the above installation setup, you can just add that line to your <code>~/.Rprofile</code> file manually.  The reason for using <code>tryCatch(..., error = ...)</code> is for the case when <strong>startup</strong> is not installed and you try to install it, e.g. after upgrading R to a new major release.  Without <code>try()</code>, R will fail to install the <strong>startup</strong> package (or any other package) because the R profile startup script produces an error complaining about <strong>startup</strong> not being available.</p>
<h2>Usage</h2>
<p>Just start R :)</p>
<p>To debug the startup process, use <code>startup::startup(debug = TRUE)</code> or set environment variable <code>R_STARTUP_DEBUG=TRUE</code>, e.g. on Linux you can do</p>
<pre><code class="language-sh">$ R_STARTUP_DEBUG=TRUE R
</code></pre>
<p>On MS Windows, you can do:</p>
<pre><code class="language-sh">$ R R_STARTUP_DEBUG=TRUE
</code></pre>
<p>This will produce time-stamped messages during startup specifying which files are included together with details on the files and what they modified.</p>
<h2>Conditional file and directory names</h2>
<p>If the name of a file consists of a <code>&lt;key&gt;=&lt;value&gt;</code> specification, then that file will be included / used only if the specification is fulfilled (on the current system with the current R setup).  For instance, a file <code>~/.Rprofile.d/os=windows.R</code> will be ignored unless <code>startup::sysinfo()$os == &quot;windows&quot;</code>, i.e. the R session is started on a Windows system.</p>
<p>The following <code>startup::sysinfo()</code> keys are available for conditional inclusion of files by their path names:</p>
<ul>
<li>
<p>System values:</p>
<ul>
<li><code>dirname</code>     - (character) the name of the current working directory (= <code>basename(getwd())</code>)</li>
<li><code>gui</code>         - (character) the graphical user interface (= <code>.Platform$GUI</code>)</li>
<li><code>nodename</code>    - (character) the host name (= <code>Sys.info()[[&quot;nodename&quot;]]</code>)</li>
<li><code>machine</code>     - (character) the machine type (= <code>Sys.info()[[&quot;machine&quot;]]</code>)</li>
<li><code>os</code>          - (character) the operating system (= <code>.Platform$OS.type</code>)</li>
<li><code>sysname</code>     - (character) the system name (= <code>Sys.info()[[&quot;sysname&quot;]]</code>)</li>
<li><code>user</code>        - (character) the user name (= <code>Sys.info()[[&quot;user&quot;]]</code>)</li>
</ul>
</li>
<li>
<p>System flags:</p>
<ul>
<li><code>interactive</code> - (logical) whether running R interactively or not (= <code>interactive()</code>)</li>
<li><code>ess</code>         - (logical) whether running R in <a href="https://ess.r-project.org/">Emacs Speaks Statistics (ESS)</a> or not</li>
<li><code>pqr</code>         - (logical) whether running <a href="http://www.pqr-project.org/">pqR</a> (&quot;A Pretty Quick Version of R&quot;) or not</li>
<li><code>radian</code>      - (logical) whether running R in <a href="https://github.com/randy3k/radian">radian</a> (formerly known as 'rtichoke' and 'rice') or not</li>
<li><code>microsoftr</code>  - (logical) whether running R in <a href="https://mran.microsoft.com/open">Microsoft R Open</a> or not</li>
<li><code>rstudio</code>     - (logical) whether running R in <a href="https://www.rstudio.com/products/RStudio/">RStudio</a> Console or not</li>
<li><code>rstudioterm</code> - (logical) whether running R in <a href="https://www.rstudio.com/products/RStudio/">RStudio</a> Terminal or not</li>
<li><code>wine</code>        - (logical) whether running R on Windows via <a href="https://www.winehq.org/">Linux Wine</a> or not</li>
</ul>
</li>
<li>
<p>Installed packages:</p>
<ul>
<li><code>package</code>     - (character) whether a package is installed or not.  In addition to checking the availability, having <code>package=&lt;name&gt;</code> in the filename makes it clear that the startup file concerns settings specific to that package.</li>
</ul>
</li>
<li>
<p>With a specific frequency:</p>
<ul>
<li><code>when</code> - (character) specify how often the file should be processed:
<ul>
<li><code>when=once</code>        - the startup file is processed only once</li>
<li><code>when=hourly</code>      - the startup file is processed at most once per hour</li>
<li><code>when=daily</code>       - the startup file is processed at most once per day</li>
<li><code>when=weekly</code>      - the startup file is processed at most once per week</li>
<li><code>when=fortnightly</code> - the startup file is processed at most once every two weeks</li>
<li><code>when=monthly</code>     - the startup file is processed at most once per month</li>
</ul>
</li>
</ul>
<p>If such a file, or its timestamp, is updated, then it will be processed the next time R is started.</p>
</li>
<li>
<p>Environment variables:</p>
<ul>
<li>Any further <code>&lt;key&gt;=&lt;value&gt;</code> specifications with keys matching none of the above known keys are interpreted as system environment variables and <strong>startup</strong> will test such conditions against their values.  <em>Note, if <code>&lt;key&gt;</code> does not correspond to a known environment variable, then the file is skipped if <code>&lt;key&gt;=&lt;value&gt;</code> is used but included if <code>&lt;key&gt;!=&lt;value&gt;</code> is used.</em></li>
</ul>
</li>
</ul>
<p>To condition on more than one key, separate <code>&lt;key&gt;=&lt;value&gt;</code> pairs by commas, e.g. <code>~/.Rprofile.d/work,interactive=TRUE,os=windows.R</code>.  This also works for directory names.  For instance, <code>~/.Rprofile.d/os=windows/work,interactive=TRUE.R</code> will be processed if running on Windows and in interactive mode.  Multiple packages may be specified.  For instance, <code>~/.Rprofile.d/package=devtools,package=future.R</code> will be used only if both the devtools and the future packages are installed.</p>
<p>It is also possible to negate a conditional filename test by using the <code>&lt;key&gt;!=&lt;value&gt;</code> specification.  For instance, <code>~/.Rprofile.d/package=doMC,os!=windows.R</code> will be processed if package <code>doMC</code> is installed and the operating system is not Windows.</p>
<h3>Secrets (conditionally on an environment variable)</h3>
<p>Renviron and Rprofile startup files with a non-declared <code>&lt;key&gt;</code> in their file names are skipped.  A non-declared key is any key that is neither one of the above predefined keys nor a declared environment variable.</p>
<p>This is useful, because it allows us to keep &quot;secrets&quot; in private files and only load them conditionally on the value of an environment variable.  For instance, we put all our secret Renviron files under <code>~/.Renviron.d/private/SECRET=banana/</code> such that they are only loaded if environment variable <code>SECRET</code> is set to exactly <code>banana</code>.  Moreover, by making sure the directory <code>~/.Renviron.d/private/</code> is only accessible by you, then it will be harder for someone else two know what your secret &quot;password&quot; (<code>banana</code>) is.  On a Unix system, you can set this up as:</p>
<pre><code class="language-sh">$ mkdir -p ~/.Renviron.d/private/SECRET=banana/
$ chmod go-rw ~/.Renviron.d/private
</code></pre>
<p>Then go ahead an put your secret Renviron files in there, e.g.</p>
<pre><code class="language-sh">.Renviron.d/private/SECRET=banana/
  +-- amazon  ## AWS_* credential &amp; settings
  +-- github  ## GITHUB_TOKEN + GITHUB_PAT
</code></pre>
<p>Now, only if <code>SECRET</code> is set to exactly <code>banana</code> when you launch R, the above secret files will be processed and the corresponding environment variables will be available from withing R.  For instance, they will be loaded if you do:</p>
<pre><code class="language-r">$ SECRET=banana R
</code></pre>
<p>but not if you do:</p>
<pre><code class="language-r">$ SECRET=badguess R
</code></pre>
<p>or if <code>SECRET</code> is unset.</p>
<p><em>Comment:</em> You can use whichever variable name you like, it does not have to be <code>SECRET</code>.  And, the &quot;password&quot; <code>banana</code> is obviously just an example.</p>
<h2>Known limitations</h2>
<h3>Setting environment variables during startup</h3>
<p>Renviron startup files is a convenient and cross-platform way of setting environment variables during the R startup process.  However, for some of the environment variables that R consults must be set early on in the R startup process (immediately after Step 1), because R only consults them once.  Examples(*) of environment variables that need to be set <em>no later than</em> <code>.Renviron</code> (Step 1) are:</p>
<ul>
<li><code>TMPDIR</code>, <code>TMP</code>, <code>TEMP</code> - the parent of R's temporary directory, cf. <code>?tempdir</code></li>
<li><code>LC_ALL</code> - locale settings used by R, e.g.  cf. <code>?locales</code></li>
<li><code>R_DEFAULT_PACKAGES</code> - default set of packages loaded when R starts, cf. <code>?Rscript</code></li>
<li><code>R_LIBS_USER</code> - user's library path, e.g. <code>R_LIBS_USER=~/R/%p-library/%v</code> is the folder specification used by default on all platforms and and R version.  The folder must exist, otherwise it is ignored by R.  The <code>%p</code> (platform) and <code>%v</code> (version) parts are R-specific conversion specifiers, cf. <code>?R_LIBS_USER</code></li>
<li><code>R_MAX_NUM_DLLS</code>, cf. <code>?dyn.load</code></li>
</ul>
<p>Any changes to these done in an 'Renviron.d' file (Step 3a), or via <code>Sys.setenv()</code> in <code>.Rprofile</code> (Step 2) or 'Rprofile.d' files (Step 3c), <em>will be ignored by R itself</em> - despite being reflected by <code>Sys.getenv()</code>.</p>
<p>Furthermore, some environment variables can not even be set in <code>.Renviron</code> (Step 1) but must be set <em>prior</em> to launching R.  This is because those variables are consulted by R very early on (prior to Step 1).  Examples(*) of environment variables that need to be set <em>prior to</em> <code>.Renviron</code> (Step 1) are:</p>
<ul>
<li><code>HOME</code> - the user's home directory</li>
<li><code>MKL_NUM_THREADS</code> and <code>OMP_NUM_THREADS</code> - the default number of threads used by OpenMP etc, cf. <em>R Installation and Administration</em></li>
</ul>
<p>These variables have to be set using methods specific to the operating system or the calling shell, e.g. in a Unix shell</p>
<pre><code class="language-sh">$ export OMP_NUM_THREADS=1
$ R
</code></pre>
<p>or per call as</p>
<pre><code class="language-sh">OMP_NUM_THREADS=1 R
</code></pre>
<p>(*) For further details on which environment variables R consults and what they are used for by R, see the R documentation and help, e.g. <code>?&quot;environment variables&quot;</code> and <code>?Startup</code>.</p>
<h2>Examples</h2>
<p>Below is a list of &quot;real-world&quot; example files:</p>
<pre><code>.Renviron.d/
  +-- lang
  +-- r_cmd_check
  +-- secrets=banana
 
.Rprofile.d/
  +-- interactive=TRUE/
      +-- help.start.R
      +-- misc.R
	  +-- package=fortunes.R
  +-- os=windows.R
  +-- repos.R
</code></pre>
<p>They are available as part of this package under <code>system.file(package = &quot;startup&quot;)</code>, e.g.</p>
<pre><code class="language-r">&gt; f &lt;- system.file(&quot;Rprofile.d&quot;, &quot;repos.R&quot;, package = &quot;startup&quot;)
&gt; file.show(f, type = &quot;text&quot;)

local({
  repos &lt;- c(CRAN = &quot;https://cloud.r-project.org&quot;)
  if (.Platform$OS.type == &quot;windows&quot;) {
     repos[&quot;CRANextra&quot;] &lt;- &quot;https://www.stats.ox.ac.uk/pub/RWin&quot;
  }
  options(repos = c(repos, getOption(&quot;repos&quot;)))
})
</code></pre>
</body>
</html>
